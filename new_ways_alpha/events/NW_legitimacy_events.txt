###########################
# Legitimacy Events
###########################

add_namespace = TRlegitimacy

# Very Good Legitimacy 85% #
country_event = {
	id = TRlegitimacy.1
	title = TRlegitimacy.1.t
	desc = TRlegitimacy.1.desc
	picture = GFX_report_event_generic_rally_3
	
	mean_time_to_happen = { days = 3 }
	
	immediate = { log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): event TRlegitimacy.1" }
	
	trigger = {
		if = {
			limit = {
				tag = TUR
				has_global_flag = NW_TUR_NEW_FOCUS_TREE
				has_country_leader = { name = "Mustafa Kemal Atatürk" ruling_only = yes }
				OR = {
					has_country_flag = TUR_liberalization_of_political_life_flag
					has_country_flag = TUR_return_to_islamism_flag
					has_country_flag = TUR_bet_on_fevzi_cakmak_flag
					has_country_flag = TUR_bet_on_pan_turkist_flag
					has_country_flag = TUR_building_socialism_flag
					has_country_flag = TUR_revive_the_green_army_flag
					has_country_flag = TUR_reject_statism_flag
				}
			}
			set_temp_variable = { tur_legitimacy_var = party_popularity@ruling_party }
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_liberalization_of_political_life_flag
						has_country_flag = TUR_return_to_islamism_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@democratic }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_bet_on_fevzi_cakmak_flag
						has_country_flag = TUR_bet_on_pan_turkist_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@fascism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_building_socialism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@communism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_revive_the_green_army_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@trozkism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_reject_statism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@anarchism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			check_variable = { tur_legitimacy_var > 0.849 }
		}
		else = {
			check_variable = { party_popularity@ruling_party > 0.849 }
		}
		NOT = {
			has_country_flag = very_good_legitimacy_flag
			has_country_flag = spain_block_legitimacy_flag
			has_government = anarchism
			has_idea = TIB_power_without_power
			has_idea = KHU_manual_state_management
		}
	}

	option = {
		name = TRlegitimacy.1.a
		if = {
			limit = {
				has_idea = disaster_legitimacy
			}
			swap_ideas = {
				remove_idea = disaster_legitimacy
				add_idea = very_good_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = very_low_legitimacy
			}
			swap_ideas = {
				remove_idea = very_low_legitimacy
				add_idea = very_good_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = low_legitimacy
			}
			swap_ideas = {
				remove_idea = low_legitimacy
				add_idea = very_good_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = normal_legitimacy
			}
			swap_ideas = {
				remove_idea = normal_legitimacy
				add_idea = very_good_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = good_legitimacy
			}
			swap_ideas = {
				remove_idea = good_legitimacy
				add_idea = very_good_legitimacy
			}
		}
		clear_legitimacy_flag = yes
		set_country_flag = very_good_legitimacy_flag
	}
}



# Good Legitimacy 65 - 84.9% #
country_event = {
	id = TRlegitimacy.2
	title = TRlegitimacy.2.t
	desc = TRlegitimacy.2.desc
	picture = GFX_report_event_generic_rally_3
	
	mean_time_to_happen = { days = 3 }
	
	immediate = { log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): event TRlegitimacy.2" }

	trigger = {
		if = {
			limit = {
				tag = TUR
				has_global_flag = NW_TUR_NEW_FOCUS_TREE
				has_country_leader = { name = "Mustafa Kemal Atatürk" ruling_only = yes }
				OR = {
					has_country_flag = TUR_liberalization_of_political_life_flag
					has_country_flag = TUR_return_to_islamism_flag
					has_country_flag = TUR_bet_on_fevzi_cakmak_flag
					has_country_flag = TUR_bet_on_pan_turkist_flag
					has_country_flag = TUR_building_socialism_flag
					has_country_flag = TUR_revive_the_green_army_flag
					has_country_flag = TUR_reject_statism_flag
				}
			}
			set_temp_variable = { tur_legitimacy_var = party_popularity@ruling_party }
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_liberalization_of_political_life_flag
						has_country_flag = TUR_return_to_islamism_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@democratic }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_bet_on_fevzi_cakmak_flag
						has_country_flag = TUR_bet_on_pan_turkist_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@fascism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_building_socialism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@communism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_revive_the_green_army_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@trozkism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_reject_statism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@anarchism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			check_variable = { tur_legitimacy_var > 0.649 }
			check_variable = { tur_legitimacy_var < 0.85 }
		}
		else = {
			check_variable = { party_popularity@ruling_party > 0.649 }
			check_variable = { party_popularity@ruling_party < 0.85 }
		}
		NOT = {
			has_country_flag = good_legitimacy_flag
			has_country_flag = spain_block_legitimacy_flag
			has_government = anarchism
			has_idea = TIB_power_without_power
			has_idea = KHU_manual_state_management
		}
	}


	option = {
		name = TRlegitimacy.2.a
		trigger = {
			NOT = {
				has_country_flag = very_good_legitimacy_flag
				has_country_flag = good_legitimacy_flag
			}
		}
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.2.a"
		if = {
			limit = {
				has_idea = disaster_legitimacy
			}
			swap_ideas = {
				remove_idea = disaster_legitimacy
				add_idea = good_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = very_low_legitimacy
			}
			swap_ideas = {
				remove_idea = very_low_legitimacy
				add_idea = good_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = low_legitimacy
			}
			swap_ideas = {
				remove_idea = low_legitimacy
				add_idea = good_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = normal_legitimacy
			}
			swap_ideas = {
				remove_idea = normal_legitimacy
				add_idea = good_legitimacy
			}
		}
		clear_legitimacy_flag = yes
		set_country_flag = good_legitimacy_flag
	}
	
	option = {
		name = TRlegitimacy.2.b
		trigger = {
			has_country_flag = very_good_legitimacy_flag
		}
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.2.b"
		swap_ideas = {
			remove_idea = very_good_legitimacy
			add_idea = good_legitimacy
		}
		clear_legitimacy_flag = yes
		set_country_flag = good_legitimacy_flag
	}
}


# Normal Legitimacy 50 - 64.9% #
country_event = {
	id = TRlegitimacy.3
	title = TRlegitimacy.3.t
	desc = TRlegitimacy.3.desc
	picture = GFX_report_event_generic_rally_3
	
	mean_time_to_happen = { days = 3 }
	
	immediate = { log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): event TRlegitimacy.3" }

	trigger = {
		if = {
			limit = {
				tag = TUR
				has_global_flag = NW_TUR_NEW_FOCUS_TREE
				has_country_leader = { name = "Mustafa Kemal Atatürk" ruling_only = yes }
				OR = {
					has_country_flag = TUR_liberalization_of_political_life_flag
					has_country_flag = TUR_return_to_islamism_flag
					has_country_flag = TUR_bet_on_fevzi_cakmak_flag
					has_country_flag = TUR_bet_on_pan_turkist_flag
					has_country_flag = TUR_building_socialism_flag
					has_country_flag = TUR_revive_the_green_army_flag
					has_country_flag = TUR_reject_statism_flag
				}
			}
			set_temp_variable = { tur_legitimacy_var = party_popularity@ruling_party }
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_liberalization_of_political_life_flag
						has_country_flag = TUR_return_to_islamism_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@democratic }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_bet_on_fevzi_cakmak_flag
						has_country_flag = TUR_bet_on_pan_turkist_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@fascism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_building_socialism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@communism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_revive_the_green_army_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@trozkism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_reject_statism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@anarchism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			check_variable = { tur_legitimacy_var > 0.499 }
			check_variable = { tur_legitimacy_var < 0.65 }
		}
		else_if = {
			limit = { has_government = anarchism }
			check_variable = { party_popularity@ruling_party > 0.499 }
		}
		else = {
			check_variable = { party_popularity@ruling_party > 0.499 }
			check_variable = { party_popularity@ruling_party < 0.65 }
		}
		NOT = {
			has_country_flag = normal_legitimacy_flag
			has_country_flag = spain_block_legitimacy_flag
		}
	}

	option = {
		name = TRlegitimacy.3.a
		trigger = {
			NOT = {
				has_country_flag = good_legitimacy_flag
				has_country_flag = very_good_legitimacy_flag
				has_country_flag = normal_legitimacy_flag
			}
		}
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.3.a"
		
		if = {
			limit = {
				has_idea = disaster_legitimacy
			}
			swap_ideas = {
				remove_idea = disaster_legitimacy
				add_idea = normal_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = very_low_legitimacy
			}
			swap_ideas = {
				remove_idea = very_low_legitimacy
				add_idea = normal_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = low_legitimacy
			}
			swap_ideas = {
				remove_idea = low_legitimacy
				add_idea = normal_legitimacy
			}
		}
		clear_legitimacy_flag = yes
		set_country_flag = normal_legitimacy_flag
	}
	
	option = {
		name = TRlegitimacy.3.b
		trigger = {
			OR = {
				has_country_flag = good_legitimacy_flag
				has_country_flag = very_good_legitimacy_flag
			}
		}
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.3.a"
		
		if = {
			limit = {
				has_idea = good_legitimacy
			}
			swap_ideas = {
				remove_idea = good_legitimacy
				add_idea = normal_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = very_good_legitimacy
			}
			swap_ideas = {
				remove_idea = very_good_legitimacy
				add_idea = normal_legitimacy
			}
		}
		clear_legitimacy_flag = yes
		set_country_flag = normal_legitimacy_flag
	}
}


# Low Legitimacy 30 - 49.9% #
country_event = {
	id = TRlegitimacy.4
	title = TRlegitimacy.4.t
	desc = TRlegitimacy.4.desc
	picture = GFX_report_event_generic_rally2
	
	mean_time_to_happen = { days = 3 }

	trigger = {
		if = {
			limit = {
				tag = TUR
				has_global_flag = NW_TUR_NEW_FOCUS_TREE
				has_country_leader = { name = "Mustafa Kemal Atatürk" ruling_only = yes }
				OR = {
					has_country_flag = TUR_liberalization_of_political_life_flag
					has_country_flag = TUR_return_to_islamism_flag
					has_country_flag = TUR_bet_on_fevzi_cakmak_flag
					has_country_flag = TUR_bet_on_pan_turkist_flag
					has_country_flag = TUR_building_socialism_flag
					has_country_flag = TUR_revive_the_green_army_flag
					has_country_flag = TUR_reject_statism_flag
				}
			}
			set_temp_variable = { tur_legitimacy_var = party_popularity@ruling_party }
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_liberalization_of_political_life_flag
						has_country_flag = TUR_return_to_islamism_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@democratic }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_bet_on_fevzi_cakmak_flag
						has_country_flag = TUR_bet_on_pan_turkist_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@fascism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_building_socialism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@communism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_revive_the_green_army_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@trozkism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_reject_statism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@anarchism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			check_variable = { tur_legitimacy_var > 0.299 }
			check_variable = { tur_legitimacy_var < 0.50 }
		}
		else = {
			check_variable = { party_popularity@ruling_party > 0.299 }
			check_variable = { party_popularity@ruling_party < 0.50 }
		}
		NOT = {
			has_country_flag = low_legitimacy_flag
			has_country_flag = spain_block_legitimacy_flag
		}
	}
	
	immediate = { log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): event TRlegitimacy.4" }

	option = {
		name = TRlegitimacy.4.a
		trigger = {
			NOT = {
				has_country_flag = normal_legitimacy_flag
				has_country_flag = good_legitimacy_flag
				has_country_flag = very_good_legitimacy_flag
				has_country_flag = low_legitimacy_flag
			}
		}
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.4.a"
		
		if = {
			limit = {
				has_idea = disaster_legitimacy
			}
			swap_ideas = {
				remove_idea = disaster_legitimacy
				add_idea = low_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = very_low_legitimacy
			}
			swap_ideas = {
				remove_idea = very_low_legitimacy
				add_idea = low_legitimacy
			}
		}
		clear_legitimacy_flag = yes
		set_country_flag = low_legitimacy_flag
	}
	
	option = {
		name = TRlegitimacy.4.b
		trigger = {
			OR = {
				has_country_flag = normal_legitimacy_flag
				has_country_flag = good_legitimacy_flag
				has_country_flag = very_good_legitimacy_flag
			}
		}
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.4.b"
		if = {
			limit = {
				has_idea = normal_legitimacy
			}
			swap_ideas = {
				remove_idea = normal_legitimacy
				add_idea = low_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = good_legitimacy
			}
			swap_ideas = {
				remove_idea = good_legitimacy
				add_idea = low_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = very_good_legitimacy
			}
			swap_ideas = {
				remove_idea = very_good_legitimacy
				add_idea = low_legitimacy
			}
		}
		clear_legitimacy_flag = yes
		set_country_flag = low_legitimacy_flag
	}
}


# Very Low Legitimacy 10 - 29.9% #
country_event = {
	id = TRlegitimacy.5
	title = TRlegitimacy.5.t
	desc = TRlegitimacy.5.desc
	picture = GFX_report_event_generic_rally2
	
	mean_time_to_happen = { days = 3 }

	trigger = {
		if = {
			limit = {
				tag = TUR
				has_global_flag = NW_TUR_NEW_FOCUS_TREE
				has_country_leader = { name = "Mustafa Kemal Atatürk" ruling_only = yes }
				OR = {
					has_country_flag = TUR_liberalization_of_political_life_flag
					has_country_flag = TUR_return_to_islamism_flag
					has_country_flag = TUR_bet_on_fevzi_cakmak_flag
					has_country_flag = TUR_bet_on_pan_turkist_flag
					has_country_flag = TUR_building_socialism_flag
					has_country_flag = TUR_revive_the_green_army_flag
					has_country_flag = TUR_reject_statism_flag
				}
			}
			set_temp_variable = { tur_legitimacy_var = party_popularity@ruling_party }
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_liberalization_of_political_life_flag
						has_country_flag = TUR_return_to_islamism_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@democratic }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_bet_on_fevzi_cakmak_flag
						has_country_flag = TUR_bet_on_pan_turkist_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@fascism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_building_socialism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@communism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_revive_the_green_army_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@trozkism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_reject_statism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@anarchism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			check_variable = { tur_legitimacy_var > 0.099 }
			check_variable = { tur_legitimacy_var < 0.30 }
		}
		else = {
			check_variable = { party_popularity@ruling_party > 0.099 }
			check_variable = { party_popularity@ruling_party < 0.30 }
		}
		NOT = {
			has_country_flag = very_low_legitimacy_flag
			has_country_flag = spain_block_legitimacy_flag
		}
	}
	
	immediate = { log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): event TRlegitimacy.5" }

	option = {
		name = TRlegitimacy.5.a
		trigger = {
			has_country_flag = disaster_legitimacy_flag
		}
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.5.a"
		swap_ideas = {
			remove_idea = disaster_legitimacy
			add_idea = very_low_legitimacy
		}
		clear_legitimacy_flag = yes
		set_country_flag = very_low_legitimacy_flag
	}
	
	option = {
		name = TRlegitimacy.5.b
		trigger = {
			NOT = {
				has_country_flag = disaster_legitimacy_flag
				has_country_flag = very_low_legitimacy_flag
			}
		}
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.5.b"
		if = {
			limit = {
				has_idea = low_legitimacy
			}
			swap_ideas = {
				remove_idea = low_legitimacy
				add_idea = very_low_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = normal_legitimacy
			}
			swap_ideas = {
				remove_idea = normal_legitimacy
				add_idea = very_low_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = good_legitimacy
			}
			swap_ideas = {
				remove_idea = good_legitimacy
				add_idea = very_low_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = very_good_legitimacy
			}
			swap_ideas = {
				remove_idea = very_good_legitimacy
				add_idea = very_low_legitimacy
			}
		}
		clear_legitimacy_flag = yes
		set_country_flag = very_low_legitimacy_flag
	}
}


# Disaster Legitimacy 9.9% #
country_event = {
	id = TRlegitimacy.6
	title = TRlegitimacy.6.t
	desc = TRlegitimacy.6.desc
	picture = GFX_report_event_generic_rally2
	
	mean_time_to_happen = { days = 3 }

	trigger = {
		if = {
			limit = {
				tag = TUR
				has_global_flag = NW_TUR_NEW_FOCUS_TREE
				has_country_leader = { name = "Mustafa Kemal Atatürk" ruling_only = yes }
				OR = {
					has_country_flag = TUR_liberalization_of_political_life_flag
					has_country_flag = TUR_return_to_islamism_flag
					has_country_flag = TUR_bet_on_fevzi_cakmak_flag
					has_country_flag = TUR_bet_on_pan_turkist_flag
					has_country_flag = TUR_building_socialism_flag
					has_country_flag = TUR_revive_the_green_army_flag
					has_country_flag = TUR_reject_statism_flag
				}
			}
			set_temp_variable = { tur_legitimacy_var = party_popularity@ruling_party }
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_liberalization_of_political_life_flag
						has_country_flag = TUR_return_to_islamism_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@democratic }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					OR = {
						has_country_flag = TUR_bet_on_fevzi_cakmak_flag
						has_country_flag = TUR_bet_on_pan_turkist_flag
					}
				}
				set_temp_variable = { tur_support_var = party_popularity@fascism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_building_socialism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@communism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_revive_the_green_army_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@trozkism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			if = {
				limit = {
					has_country_flag = TUR_reject_statism_flag
				}
				set_temp_variable = { tur_support_var = party_popularity@anarchism }
				add_to_temp_variable = { tur_legitimacy_var = tur_support_var }
			}
			check_variable = { tur_legitimacy_var < 0.099 }
		}
		else = {
			check_variable = { party_popularity@ruling_party < 0.099 }
		}
		NOT = {
			has_country_flag = disaster_legitimacy_flag
			has_country_flag = spain_block_legitimacy_flag
			has_country_leader = { name = "David Murray Anderson" ruling_only = yes }
			has_country_leader = { name = "Humphrey T. Walwyn" ruling_only = yes }
			has_country_leader = { name = "Gordon Macdonald" ruling_only = yes }
			has_country_leader = { name = "John Hope Simpson" ruling_only = yes }
		}
	}
	
	immediate = { log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): event TRlegitimacy.6" }

	option = {
		name = TRlegitimacy.6.a
		if = {
			limit = {
				has_idea = very_low_legitimacy
			}
			swap_ideas = {
				remove_idea = very_low_legitimacy
				add_idea = disaster_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = low_legitimacy
			}
			swap_ideas = {
				remove_idea = low_legitimacy
				add_idea = disaster_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = normal_legitimacy
			}
			swap_ideas = {
				remove_idea = normal_legitimacy
				add_idea = disaster_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = good_legitimacy
			}
			swap_ideas = {
				remove_idea = good_legitimacy
				add_idea = disaster_legitimacy
			}
		}
		if = {
			limit = {
				has_idea = very_good_legitimacy
			}
			swap_ideas = {
				remove_idea = very_good_legitimacy
				add_idea = disaster_legitimacy
			}
		}
		clear_legitimacy_flag = yes
		set_country_flag = disaster_legitimacy_flag
	}
}


# Ref or CivilWar? #
country_event = {
	id = TRlegitimacy.7
	title = TRlegitimacy.7.t
	desc = TRlegitimacy.7.desc
	picture = GFX_report_event_generic_rally2

	trigger = {
		has_country_flag = disaster_legitimacy_flag
		has_civil_war = no
		NOT = {
			has_country_flag = block_choosen_event
			has_country_flag = spain_block_legitimacy_flag
			has_country_leader = { name = "David Murray Anderson" ruling_only = yes }
			has_country_leader = { name = "Humphrey T. Walwyn" ruling_only = yes }
			has_country_leader = { name = "Gordon Macdonald" ruling_only = yes }
		}
	}
	
	mean_time_to_happen = { days = 5 }
	
	immediate = { log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): event TRlegitimacy.7" }
	immediate = {
		if = {
			limit = {
				OR = {
					is_puppet = yes
					has_autonomy_state = associated_state
				}
			}
			ROOT = {
				OVERLORD = { save_global_event_target_as = target_overlord }
			}
		}
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): democratic: [?party_popularity@democratic]"
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): communism: [?party_popularity@communism]"
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): fascism: [?party_popularity@fascism]"
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): neutrality: [?party_popularity@neutrality]"
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): technocracy: [?party_popularity@technocracy]"
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): trozkism: [?party_popularity@trozkism]"
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): monarchy: [?party_popularity@monarchy]"
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): anarchism: [?party_popularity@anarchism]"
	}
	
	# Ref #
	option = {
		name = TRlegitimacy.7.a
		ai_chance = { factor = 90 }
		trigger = {
			is_puppet = no
			NOT = { has_autonomy_state = associated_state }
		}
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.7.a"
		hidden_effect = {
			if = {
				limit = {
					OR = {
						check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@communism }
						check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@neutrality }
						check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@fascism }
						check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@monarchy }
						check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@anarchism }
					}
				}
				set_politics = {
					ruling_party = var:highest_party_ideology@exclude_ruling_party
					elections_allowed = no
				}
			}
			else_if = {
				limit = {
					OR = {
						check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@democratic }
						check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@technocracy }
						check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@trozkism }
					}
				}
				set_politics = {
					ruling_party = var:highest_party_ideology@exclude_ruling_party
					elections_allowed = yes
				}
			}
			country_event = { id = TRlegitimacy.8 days = 1 }
			clr_country_flag = block_choosen_event
		}
		custom_effect_tooltip = referendum_chosen_tt
	}
	
	# Civil War #
	option = {
		name = TRlegitimacy.7.b
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				is_major = yes
			}
		}
		trigger = {
			is_puppet = no
			NOT = { has_autonomy_state = associated_state }
			num_of_controlled_states > 1
		}
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.7.b"
		hidden_effect = {
			start_civil_war = {
				ideology = var:highest_party_ideology@exclude_ruling_party
				size = 0.5
			}
			add_popularity = { ideology = var:highest_party_ideology@exclude_ruling_party popularity = -1 }
			country_event = { id = TRlegitimacy.8 days = 1 }
			clr_country_flag = block_choosen_event
		}
		custom_effect_tooltip = civilwar_governments_choosen_tt
	}
	
	# Марионетка #
	option = {
		name = TRlegitimacy.7.c
		
		trigger = {
			is_subject = yes
		}
		ai_chance = { factor = 200 }
		
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.7.c"
		
		custom_effect_tooltip = puppet_choosen_tt
		hidden_effect = {
			OVERLORD = { country_event = { id = TRlegitimacy.9 days = 1 } }
			clear_global_event_target = target_overlord
		}
	}
}

# Hidden Set Legitimacy #
country_event = {
	id = TRlegitimacy.8
	title = TRlegitimacy.8.t
	desc = TRlegitimacy.8.desc
	picture = GFX_report_event_generic_rally_3
	hidden = yes
	is_triggered_only = yes
	
	immediate = { log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): event TRlegitimacy.8" }
	
	option = {
		name = TRlegitimacy.8.a
		clear_legitimacy_flag = yes
		remove_ideas = {
			disaster_legitimacy
			very_low_legitimacy
			low_legitimacy
			normal_legitimacy
			good_legitimacy
			very_good_legitimacy
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = spain_block_legitimacy_flag
					has_idea = TIB_power_without_power
					has_idea = KHU_manual_state_management
				}
				check_variable = { party_popularity@ruling_party > 0.849 }
			}
			add_ideas = very_good_legitimacy
			set_country_flag = very_good_legitimacy_flag
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = spain_block_legitimacy_flag
					has_idea = TIB_power_without_power
					has_idea = KHU_manual_state_management
				}
				check_variable = { party_popularity@ruling_party > 0.649 }
				check_variable = { party_popularity@ruling_party < 0.85 }
			}
			add_ideas = good_legitimacy
			set_country_flag = good_legitimacy_flag
		}
		if = {
			limit = {
				OR = {
					has_country_flag = spain_block_legitimacy_flag
					has_idea = TIB_power_without_power
					has_idea = KHU_manual_state_management
					AND = {
						check_variable = { party_popularity@ruling_party > 0.499 }
						check_variable = { party_popularity@ruling_party < 0.65 }
					}
				}
			}
			add_ideas = normal_legitimacy
			set_country_flag = normal_legitimacy_flag
		}
		if = {
			limit = {
				NOT = { has_country_flag = spain_block_legitimacy_flag }
				check_variable = { party_popularity@ruling_party > 0.299 }
				check_variable = { party_popularity@ruling_party < 0.50 }
			}
			add_ideas = low_legitimacy
			set_country_flag = low_legitimacy_flag
		}
		if = {
			limit = {
				NOT = { has_country_flag = spain_block_legitimacy_flag }
				check_variable = { party_popularity@ruling_party > 0.099 }
				check_variable = { party_popularity@ruling_party < 0.30 }
			}
			add_ideas = very_low_legitimacy
			set_country_flag = very_low_legitimacy_flag
		}
		if = {
			limit = {
				NOT = { has_country_flag = spain_block_legitimacy_flag }
				check_variable = { party_popularity@ruling_party < 0.099 }
			}
			add_ideas = disaster_legitimacy
			set_country_flag = disaster_legitimacy_flag
		}
	}
}

# Лорд - Бунты у марионеток #
country_event = {
	id = TRlegitimacy.9
	title = TRlegitimacy.9.t
	desc = TRlegitimacy.9.desc
	picture = GFX_report_event_generic_rally_3
	is_triggered_only = yes
	
	immediate = { log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): event TRlegitimacy.9" }
	
	option = {
		name = TRlegitimacy.9.a
		ai_chance = { factor = 50 }
		
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.9.a"
		
		add_political_power = -100
		add_stability = 0.05
		FROM = {
			add_stability = 0.05
			clr_country_flag = block_choosen_event
			add_popularity = { ideology = var:current_party_ideology_group popularity = 0.30 }
		}
	}
	option = {
		name = TRlegitimacy.9.b
		ai_chance = { factor = 50 }
		
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.9.b"
		
		add_political_power = -50
		custom_effect_tooltip = middle_support
		hidden_effect = {
			random_list = {
				50 = {
					FROM = { country_event = { id = TRlegitimacy.10 days = 1 } }
				}
				35 = {
					FROM = {
						clr_country_flag = block_choosen_event
						add_popularity = { ideology = var:current_party_ideology_group popularity = 0.15 }
					}
				}
				15 = {
					FROM = {
						clr_country_flag = block_choosen_event
						add_stability = 0.05
						add_popularity = { ideology = var:current_party_ideology_group popularity = 0.2 }
					}
				}
			}
		}
	}
	option = {
		name = TRlegitimacy.9.c
		ai_chance = { factor = 50 }
		
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.9.c"
		
		add_stability = -0.05
		custom_effect_tooltip = no_support
		hidden_effect = {
			FROM = {
				add_stability = -0.05
				add_war_support = 0.05
				country_event = { id = TRlegitimacy.10 days = 1 }
			}
		}
	}
}

# Марионетка - Старт бунтов #
country_event = {
	id = TRlegitimacy.10
	title = TRlegitimacy.10.t
	desc = TRlegitimacy.10.desc
	picture = GFX_report_event_generic_rally_3
	is_triggered_only = yes
	
	immediate = { log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): event TRlegitimacy.10" }

	# Ref #
	option = {
		name = TRlegitimacy.10.a
		ai_chance = { factor = 50 }
		
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.10.a"

		ROOT = {
			hidden_effect = {
				if = {
					limit = {
						OR = {
							check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@communism }
							check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@neutrality }
							check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@fascism }
							check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@monarchy }
							check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@anarchism }
						}
					}
					set_politics = {
						ruling_party = var:highest_party_ideology@exclude_ruling_party
						elections_allowed = no
					}
				}
				else_if = {
					limit = {
						OR = {
							check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@democratic }
							check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@technocracy }
							check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@trozkism }
						}
					}
					set_politics = {
						ruling_party = var:highest_party_ideology@exclude_ruling_party
						elections_allowed = yes
					}
				}
				clr_country_flag = block_choosen_event
				country_event = { id = TRlegitimacy.8 days = 1 }
			}
			custom_effect_tooltip = referendum_chosen_tt
		}
	}
	
	# Civil War #
	option = {
		name = TRlegitimacy.10.b
		ai_chance = { factor = 50 }
		
		trigger = {
			num_of_controlled_states > 1
		}
		
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): choose option TRlegitimacy.10.b"
		
		ROOT = {
			hidden_effect = {
				start_civil_war = {
					ideology = var:highest_party_ideology@exclude_ruling_party
					size = 0.5
				}
				add_popularity = { ideology = var:highest_party_ideology@exclude_ruling_party popularity = -1 }
				country_event = { id = TRlegitimacy.8 days = 1 }
				clr_country_flag = block_choosen_event
			}
			custom_effect_tooltip = civilwar_governments_choosen_tt
		}
	}
}


#TEST
country_event = {
	id = TRlegitimacy.999
	is_triggered_only = yes
	hidden = yes
	
	immediate = { log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): event TRlegitimacy.999" }
	
	option = {
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): highest_party_ideology: [?highest_party_ideology@exclude_ruling_party]"
		log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): current_party_ideology_group: [?current_party_ideology_group]"
		if = {
			limit = { NOT = { has_government = var:highest_party_ideology } }
			set_politics = {
				ruling_party = var:highest_party_ideology
			}
		}
	}
	
	option = {
		add_popularity = { ideology = var:current_party_ideology_group popularity = -0.05 }
	}
	
	option = {
		if = {
			limit = {
				OR = {
					check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@communism }
					check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@neutrality }
					check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@fascism }
					check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@monarchy }
					check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@anarchism }
				}
			}
			set_politics = {
				ruling_party = var:highest_party_ideology@exclude_ruling_party
				elections_allowed = no
			}
			add_political_power = 1
		}
		else_if = {
			limit = {
				OR = {
					check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@democratic }
					check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@technocracy }
					check_variable = { highest_party_popularity@exclude_ruling_party = party_popularity@trozkism }
				}
			}
			set_politics = {
				ruling_party = var:highest_party_ideology@exclude_ruling_party
				elections_allowed = yes
			}
			add_stability = 0.01
		}
	}
	
	option = {
		start_civil_war = {
			ideology = var:highest_party_ideology@exclude_ruling_party
			size = 0.5
		}
		add_popularity = { ideology = var:highest_party_ideology@exclude_ruling_party popularity = -1 }
	}
}